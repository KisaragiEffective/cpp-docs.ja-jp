---
title: Visual Studio プロジェクトでのプロパティの継承 - C++
ms.date: 05/16/2019
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 472700226ffc1f265f6fab84dbd44fca651b3c87
ms.sourcegitcommit: a10c9390413978d36b8096b684d5ed4cf1553bc8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/17/2019
ms.locfileid: "65837401"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Visual Studio プロジェクトでのプロパティの継承

Visual Studio プロジェクト システムは MSBuild に基づいており、MSBuild ではファイルの形式と、任意の種類のプロジェクトをビルドするためのルールが定義されています。 MSBuild は、複数の構成とプラットフォームに対するビルドの複雑さの大部分を管理しますが、そのしくみについて少し理解しておく必要があります。 これは、カスタム構成を定義する場合、または複数のプロジェクトで共有してインポートできる再利用可能なプロパティのセットを作成する場合に、特に重要です。

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>.vcxproj ファイル、.props ファイル、および .targets ファイル

プロジェクトのプロパティは、プロジェクト ファイル (*.vcxproj) に直接格納されるか、またはプロジェクト ファイルによってインポートされる他の .targets ファイルまたは .props ファイルに格納されて、既定値を提供します。 Visual Studio 2015 では、これらのファイルは **\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140** にあります。 Visual Studio 2017 または Visual Studio 2019 では、これらのファイルは **\\Program Files (x86)\\Microsoft Visual Studio\\&lt;2017 または 2019>\\_edition_\\Common7\\IDE\\VC\\VCTargets** にあります。_edition_ はインストールされている Visual Studio のエディションです。 プロパティは、独自のプロジェクトに追加されているすべてのカスタム .props ファイルにも格納されます。 これらのファイルは手動で編集しないことを強くお勧めします。MSBuild を非常によく理解しているのでないかぎり、すべてのプロパティの変更には IDE のプロパティ ページを使ってください。継承に関わるプロパティは特にそうです。

前に示したように、同じ構成の同じプロパティに対し、これらの異なるファイルで異なる値を割り当てることができます。 プロジェクトをビルドするとき、MSBuild エンジンは、プロジェクト ファイルとすべてのインポートされたファイルを、適切に定義された順序 (後述) で評価します。 各ファイルが評価されると、そのファイルで定義されているすべてのプロパティ値が、既存の値をオーバーライドします。 指定されていない値は、前に評価されたファイルから継承されます。 そのため、プロパティ ページでプロパティを設定するときは、それを設定する場所にも注意を払うことが重要です。 あるプロパティを .props ファイルで "X" に設定しても、プロジェクト ファイルでそのプロパティが "Y" に設定されている場合、プロジェクトは "Y" に設定されたプロパティでビルドされます。 同じプロパティが .cpp ファイルなどのプロジェクト項目で "Z" に設定されている場合、MSBuild エンジンは値 "Z" を使います。 

基本的な継承ツリーを次に示します。

1. MSBuild CPP ツールセットの既定の設定 (.vcxproj ファイルによってインポートされる ..\Program Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props)

2. プロパティ シート

3. .vcxproj ファイル (既定値とプロパティ シートの設定をオーバーライド可能)。

4. 項目メタデータ

> [!TIP]
> プロパティ ページで、`bold` のプロパティは、現在のコンテキストで定義されます。 通常フォントのプロパティが継承されます。

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>インポートされたすべての値を含む展開されたプロジェクト ファイルを表示する

指定したプロパティ値がどのように継承されているかを特定するために、拡張されたファイルを表示すると便利な場合があります。 拡張されたバージョンを表示するには、Visual Studio コマンド プロンプトで次のコマンドを入力します (プレースホルダー ファイル名を適宜変更してください)。

**msbuild /pp:** *temp* **.txt** *myapp* **.vcxproj**

拡張されたプロジェクト ファイルは大きく、MSBuild に詳しくない場合は理解するのが難しい可能性があります。 プロジェクト ファイルの基本的な構造を次に示します。

1. IDE では公開されていない基本的なプロジェクトのプロパティ。

2. ツールセットに依存しない一部の基本的なプロパティを定義する Microsoft.cpp.default.props のインポート。

3. グローバル構成プロパティ ( **[Configuration General]\(構成概要\)** ページの **[PlatformToolset]** および **[プロジェクト]** 既定プロパティとして公開されます)。 これらのプロパティは、次の手順の Microsoft.cpp.props でインポートされるツールセットおよび組み込みプロパティ シートを決定します。

4. プロジェクトのほとんどの既定値を設定する Microsoft.cpp.props のインポート。

5. .user を含むすべてのプロパティ シートのインポート。 これらのプロパティ シートは、 **[PlatformToolset]** および **[プロジェクト]** の既定プロパティを除くすべてをオーバーライドできます。

6. プロジェクト構成プロパティの残り。 これらの値は、プロパティ シートの設定をオーバーライドできます。

7. 項目 (ファイル) とそのメタデータ。 これらは、他のプロパティやインポートの前に発生した場合でも、常に MSBuild 評価規則の最後の単語です。

詳細については、「[MSBuild プロパティ](/visualstudio/msbuild/msbuild-properties)」を参照してください。

## <a name="build-configurations"></a>ビルドの構成

構成は、名前が与えられたプロパティの任意のグループでしかありません。 Visual Studio では、デバッグ構成とリリース構成が提供されており、それぞれにおいてデバッグ ビルドまたはリリース ビルドに適したさまざまなプロパティが設定されています。 **構成マネージャー**を使うと、特定のビルド フレーバーに対するプロパティをグループ化するための便利な方法として、カスタム構成を定義できます。 

ビルド構成をより良く理解するには、設定に応じて **[表示] &#124; [プロパティ マネージャー]** または **[表示] &#124; [その他のウィンドウ] &#124; [プロパティ マネージャー]** を選択して、**プロパティ マネージャー**を開きます。 **プロパティ マネージャー**には、プロジェクトの構成とプラットフォームのペアごとにノードがあります。 これらの各ノードの下には、その構成に固有のプロパティを設定するプロパティ シート (.props ファイル) のノードがあります。

![プロパティ マネージャー](media/property-manager.png "プロパティ マネージャー")

プロパティ ページの [全般] ウィンドウに移動し、[文字セット] プロパティを [Use Unicode]\(Unicode を使用\) ではなく [設定なし] に設定して、 **[OK]** をクリックすると、プロパティ マネージャーでは現在の構成に対して **[Unicode Support]\(Unicode のサポート\)** プロパティ シートが表示されなくなりますが、他の構成のためにプロパティ シートは残っています。

プロパティ マネージャーおよびプロパティ シートの詳細については、[Visual Studio C++ プロジェクト設定の共有または再利用](create-reusable-property-configurations.md)に関するページを参照してください。

> [!TIP]
> .user ファイルはレガシ機能であり、構成/プラットフォームに従ってプロパティが正しくグループ化されるように、削除することをお勧めします。



